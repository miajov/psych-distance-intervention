---
title: "Psychological distance intervention reminders reduce alcohol consumption frequency in daily life"
author: "Mia Jovanova"
date: "`r Sys.Date()`"
output: 
  html_document:
    code_folding: hide
    highlight: tango
    number_sections: yes
    theme: united
    toc: yes
    toc_depth: 4
    toc_float: yes
urlcolor: blue
editor_options: 
  chunk_output_type: inline
---

<br><br> 



**Study Background**

Using two randomized experiments, we examine whether theory-driven strategies to create psychological distance—mindfulness and perspective-taking—administered via smartphones, can reduce drinking in the daily lives of young adults over 28 days (Study1, N = 108; Study 2, N=218).


**Citation**

Jovanova, M., Cosme, D., Doré, B., Kang, Y., Stanoi, O., Cooper, N., Helion, C., Lomax, S., McGowan, A., Boyd, Z., Basset, S, D., Mucha, J, P., Ochsner, P., Lydon-Staley, M, D & Falk, E. (2022).<a href="https://psyarxiv.com/yw7s3/"> Psychological distance intervention reminders reduce alcohol consumption frequency in daily life.</a>

```{r setup, include=F, warning=F}
rm(list=ls()) 

#Load packages
if(!require('pacman')) {install.packages('pacman')}
pacman::p_load(dplyr, rstatix, ggpubr, kableExtra, DataCombine, sjmisc, sjPlot, janitor, reshape,
               emmeans, ggplot2, glmmTMB, coefplot2, psych, sjPlot, MASS, gtsummary, coefplot2, coin)

#Define aesthetics
palette = c("darkgray","#0C7BDC","#D55E00")
```

# Load & prepare modeling data

```{r}
#EMA1 = Study 1 ecological momentary assessment clean dataframe
EMA1 = read.csv("data/osf_study1.csv", stringsAsFactors = FALSE)

#EMA2 = Study 2 ecological momentary assessment clean dataframe
EMA2 = read.csv("data/osf_study2.csv", stringsAsFactors = FALSE)

interventions_s1 = EMA1  %>% 
  filter(condition != 'control') %>% # filter individuals in control without a within-person manipulation 
  mutate(active_week =relevel(factor(active_week), ref = 'control')) #factor main predictor and set inactive weeks as reference. 

interventions_s2 = EMA2 %>% 
  filter(condition != 'control') %>% #filter individuals in control without a within-person manipulation 
  mutate(active_week =relevel(factor(active_week), ref = 'control')) #factor main predictor and set inactive weeks as reference. 
```


# Main analyses
## Within-person analyses {.tabset}

[ADD RESEARCH QUESTION HERE]

[ADD HYPOTHESIS HERE]

[DEFINE VARIABLES OR MODIFY THE DATAFRAME TO ADD ATTRIBUTES https://www.danieldsjoberg.com/gtsummary/articles/tbl_regression.html]

Note:

* The zero-inflated sub-model of the hurdle model estimated the probability of an extra zero (no alcohol use) such that a positive odds ratio indicates more occasions with no alcohol use. 

* A positive odds ratio indicates more occasions with no alcohol use. 

<br><br>

### Study 1 

Consistent with your hypothesis, active compared to inactive weeks were associated with a higher probability  of not drinking: OR = 1.34,  95% CI [1.01 - 1.77],  p = .041.

```{r}
m_main_s1 <- glmmTMB(drinks_number ~ 1 +  active_week + condition 
                  + signal_count + alc_responses + social_weekend + active_week*condition + (1 | group/id),
                  zi = ~1 + active_week + condition 
                  + signal_count +  alc_responses + social_weekend + active_week*condition + (1 | group/id),
                  data = interventions_s1, 
                  family = truncated_nbinom2)

tbl_regression(m_main_s1,
               exponentiate = TRUE, conf.level = 0.95,
               pvalue_fun = ~style_pvalue(.x, digits = 3)) %>%
  modify_table_body(filter, !(variable == "active_week" & label == "control")) %>%
  bold_p() %>%
  remove_row_type(., variables = everything(),type = c("header"))
```


### Study 2

Consistent with your hypothesis, active compared to inactive weeks were associated with a higher probability  of not drinking: OR = 1.39,  95% CI [1.08 - 1.80],  p = .011

```{r}
m_main_s2 <- glmmTMB(drinks_number ~ 1 +  active_week + condition 
                  + signal_count +  alc_responses + social_weekend + active_week*condition + (1 | group/id),
                  zi = ~1 + active_week + condition 
                  + signal_count +  alc_responses + social_weekend + active_week*condition + (1 | group/id),
                  data = interventions_s2, 
                  family = truncated_nbinom2)

tbl_regression(m_main_s2,
               exponentiate = TRUE, conf.level = 0.95,
               pvalue_fun = ~style_pvalue(.x, digits = 3)) %>%
  modify_table_body(filter, !(variable == "active_week" & label == "control")) %>%
  bold_p() %>%
  remove_row_type(., variables = everything(),type = c("header")) 
```


### Plot

[DESCRIBE THE PLOT AND STATE FIGURE NUMBER FROM MANUSCRIPT]

```{r, fig.width = 7, fig.height = 8} 
plot1 = read.csv("data/EMA_plot1_osf.csv", stringsAsFactors = FALSE)
plot2 = read.csv("data/EMA_plot2_osf.csv", stringsAsFactors = FALSE)

par(mfrow = c(2,2))
layout.matrix <- matrix(c(0, 2, 1, 3), nrow = 2, ncol = 2)

names=c("control \n inactive weeks", "mindful \n active (left) \ninactive (right)", "perspective \n active (left) \ninactive (right)")

#plotting drinking frequency study 1
m1=lm(prop_occasions_on ~ 0 + condition, data = plot1)
m2=lm(prop_occasions_off ~ 0 + condition, data = plot1)

m1coefs=c(NA,coeftab(m1)$Estimate)
m1ses=c(NA,coeftab(m1)$Std)

m2coefs=coeftab(m2)$Estimate
m2ses=coeftab(m2)$Std

coefplot2(m1coefs,m1ses,CI=.2, names, pch= 21,cex.pts= 2,vertical=F, 
          main = "Study 1",  var.las =1, ylim=c(.05,.25), cex.axis=3,
          ylab="proportion of drinking occasions", xlab="conditions", col.pts=palette)

coefplot2(m2coefs,m2ses,names, CI=.2, pch= 16,cex.pts= 2,vertical=F, offset = .15, ylim=c(.05,.25), main = "Study 1", 
                  var.las =1, cex.axis=3, ylab="proportion of drinking occasions", add=T, col.pts=palette)

#plotting drinking frequency study 2
m1_s2=lm(prop_occasions_on ~ 0 + condition, plot2)
m2_s2=lm(prop_occasions_off ~ 0 + condition, plot2)

m1_s2coefs=c(NA,coeftab(m1_s2)$Estimate)
m1_s2ses=c(NA,coeftab(m1_s2)$Std)

m2_s2coefs=coeftab(m2_s2)$Estimate
m2_s2ses=coeftab(m2_s2)$Std

coefplot2(m1_s2coefs,m1_s2ses,names, CI=.95, pch= 21,cex.pts= 2,vertical=F, 
          main = "Study 2",  var.las =1, ylim=c(.05,.25), cex.axis=3,
          ylab="proportion of drinking occasions", xlab="conditions", col.pts=palette)

coefplot2(m2_s2coefs,m2_s2ses,names, CI=.95, pch= 16,cex.pts= 2,vertical=F, offset = .15, ylim=c(.05,.25), 
          main = "Study 2", 
                  var.las =1, cex.axis=3, ylab="proportion of drinking occasions", add=T, col.pts=palette)

##plotting amount study 1
m1on_1=lm(drinks_per_occ_on ~ 0 + condition, plot1)
m2off_1=lm(drinks_per_occ_off ~ 0 + condition, plot1)

m1d_oncoefs_1=c(NA,coeftab(m1on_1)$Estimate)
m1d_onses_1=c(NA,coeftab(m1on_1)$Std)

m1d_off_coefs_1=coeftab(m2off_1)$Estimate
m1d_offses_1=coeftab(m2off_1)$Std

coefplot2(m1d_oncoefs_1,m1d_onses_1,names,pch= 21, plot =TRUE, CI = .95, cex.pts= 2, vertical=F, ylim=c(0,5),
          xlab="conditions",main="Study 1", ylab="average drinks per occasion",var.las =1, col.pts=palette)
coefplot2(m1d_off_coefs_1,m1d_offses_1,names, pch= 16, plot = TRUE, CI =.95, cex.pts= 1.5,vertical=F, ylim=c(0,5),
          xlab="conditions",offset = .2,ylab="average drinks per occasion", var.las =1, add=T,col.pts=palette)

##plotting amount study 2
m1_on_d2=lm(drinks_per_occ_on ~ 0 + condition, plot2)
m2_off_d2=lm(drinks_per_occ_off ~ 0 + condition, plot2)

s2_m1dcoefs=c(NA,coeftab(m1_on_d2)$Estimate)
s2_m1dses=c(NA,coeftab(m1_on_d2)$Std)

m2dcoefs2=coeftab(m2_off_d2)$Estimate
m2dses2=coeftab(m2_off_d2)$Std

coefplot2(s2_m1dcoefs,s2_m1dses,names,pch= 21, plot =TRUE, CI = .95, cex.pts= 1.5, vertical=F, ylim=c(0,5),
          xlab="conditions", main = "Study 2", ylab="average drinks per occasion",var.las =1, col.pts=palette)

coefplot2(m2dcoefs2,m2dses2,names, pch= 16, plot = TRUE, CI =.95, cex.pts= 1.5,vertical=F, ylim=c(0,5),
          xlab= "conditions", offset = .2, main="Study 2", ylab="average drinks per occasion", add=T,var.las =1, col.pts=palette)
```

<br><br>

## Between-person analyses {.tabset}

[ADD RESEARCH QUESTION HERE]

[ADD HYPOTHESIS HERE]

[DESCRIBE METHOD HERE --> NOT SURE WHAT THE OUTPUT MEANS]

```{r}
#load change scores 
change_scores_1 = read.csv("data/prop_diff_plot1.csv", stringsAsFactors = FALSE) %>% 
  mutate(intervention = case_when(condition == 'mindful' | condition == 'perspective' ~ 'intervention',  TRUE ~ 'control'))

change_scores_2 = read.csv("data/prop_diff_plot2.csv", stringsAsFactors = FALSE) %>% 
  mutate(intervention = case_when(condition == 'mindful' | condition == 'perspective' ~ 'intervention',  TRUE ~ 'control'))
```

### Study 1

[DESCRIBE RESULTS HERE]

```{r}
#run wilcox test 
compare_means(prop_diff ~ intervention, method = "wilcox.test", data = change_scores_1) %>%
  data.frame() %>%
  select(group1, group2, p.format) %>%
  kable(format = "pandoc")
  
qnorm(wilcox.test(change_scores_1$prop_diff ~ change_scores_1$intervention)$p.value/2)

change_scores_1 %>% wilcox_effsize(prop_diff ~ intervention) %>%
  select(-`.y.`) %>%
  kable(format = "pandoc")
```

### Study 2

[DESCRIBE RESULTS HERE]

```{r}
#run wilcox test 
compare_means(prop_diff ~ intervention, method = "wilcox.test", data = change_scores_2) %>%
  data.frame() %>%
  select(group1, group2, p.format) %>%
  kable(format = "pandoc")
  
qnorm(wilcox.test(change_scores_2$prop_diff ~ change_scores_2$intervention)$p.value/2)
  
change_scores_2 %>% wilcox_effsize(prop_diff ~ intervention) %>%
  select(-`.y.`) %>%
  kable(format = "pandoc")
```

### Plot

```{r}
#graphing EMA FREQUENCY within-person 
change_scores_1$prop_diff_1 = change_scores_1$prop_diff*-1 #[DESCRIBE WHAT YOURE DOING HERE]
change_scores_2$prop_diff_1 = change_scores_2$prop_diff*-1 #[DESCRIBE WHAT YOURE DOING HERE]

m1=lm(prop_diff_1~  0 + condition, change_scores_1)
m2=lm(prop_diff_1~  0 + condition, change_scores_2)

names=c("control", "mindful", "perspective")

par(mfrow = c(2,2))
coefplot2(m1, intercept = TRUE, 
          pch= 18,cex.pts= 2,CI=.95,
          names, 
          lwd.1 = 0,
          main = "Study 1", ylab="% change scores in drinking frequency",
          ylim=c(-.08,.05), xlab="conditions",   var.las =1, 
          vertical=F, 
          col.pts=c("darkgray", "#0C7BDC","#D55E00"))

coefplot2(m2, intercept = TRUE, 
          pch= 18,cex.pts= 2,CI=.95,
          names, 
           main = "Study 2",
          ylim=c(-.08,.05), xlab="conditions",
          offset = .2, ylab="% change scores in drinking frequency", var.las =1, 
          lwd.1 = 0,
          vertical=F, 
          col.pts=c("darkgray", "#0C7BDC","#D55E00"))
```

<br><br>

# Supplementary analyses
## Within-person {.tabset}

[ADD RESEARCH QUESTION HERE]

[ADD HYPOTHESIS HERE]

[DEFINE VARIABLES OR MODIFY THE DATAFRAME TO ADD ATTRIBUTES https://www.danieldsjoberg.com/gtsummary/articles/tbl_regression.html]

<br><br>

### Study 1

[DESCRIBE RESULTS HERE]

```{r}
osf_study1_supp = read.csv("data/osf_study1_supp.csv", stringsAsFactors = FALSE) %>%
  filter(condition != 'control') %>%
  mutate(active_week =relevel(factor(active_week), ref = 'control'))

osf_study2_supp  = read.csv("data/osf_study2_supp.csv", stringsAsFactors = FALSE) %>%
  filter(condition != 'control') %>%
  mutate(active_week =relevel(factor(active_week), ref = 'control')) 

m_supp_s1 <- glmmTMB(drinks_number ~ 1 +  active_week + condition 
                  + signal_count +  alc_responses + social_weekend + age + gender + race + active_week*condition + (1 | group/id),
                  zi = ~1 + active_week + condition + signal_count +  alc_responses + social_weekend +
                    age + gender + race + active_week*condition + (1 | group/id),
                  data = osf_study1_supp, 
                  family = truncated_nbinom2)

tbl_regression(m_supp_s1, 
               exponentiate =TRUE, conf.level = 0.95,
               pvalue_fun = ~style_pvalue(.x, digits = 3)) %>%
  modify_table_body(filter, !(variable == "active_week" & label == "control")) %>%
  bold_p() %>%
  remove_row_type(., variables = everything(),type = c("header"))
```

### Study 2

[DESCRIBE RESULTS HERE]

```{r}
m_supp_s2 <- glmmTMB(drinks_number ~ 1 +  active_week + condition 
                  + signal_count +  alc_responses + social_weekend + age + gender + race + active_week*condition + (1 |  group/id),
                  zi = ~1 + active_week + condition + signal_count +  alc_responses + social_weekend +
                    age + gender + race + active_week*condition + (1 | group/id),
                  data = osf_study2_supp, 
                  family = truncated_nbinom2)

tbl_regression(m_supp_s2, 
               exponentiate =TRUE, conf.level = 0.95,
               pvalue_fun = ~style_pvalue(.x, digits = 3)) %>%
  modify_table_body(filter, !(variable == "active_week" & label == "control")) %>%
  bold_p() %>%
  remove_row_type(., variables = everything(),type = c("header"))
```

<br><br>

## Between-person {.tabset}

[ADD RESEARCH QUESTION HERE]

[DESCRIBE METHOD HERE --> NOT SURE WHAT THE OUTPUT MEANS]

Winsorizing outliers 2sd from mean 

```{r}
change_scores_1 = read.csv("data/prop_diff_plot1.csv", stringsAsFactors = FALSE) %>% 
  mutate(intervention = case_when(condition == 'mindful' | condition == 'perspective' ~ 'intervention',  TRUE ~ 'control'), prop_diff_w =winsor(prop_diff, trim = 0.2, na.rm = TRUE))

change_scores_2 = read.csv("data/prop_diff_plot2.csv", stringsAsFactors = FALSE) %>% 
  mutate(intervention = case_when(condition == 'mindful' | condition == 'perspective' ~ 'intervention',  TRUE ~ 'control'), prop_diff_w =winsor(prop_diff, trim = 0.2, na.rm = TRUE))
```

### Study 1

[DESCRIBE RESULTS HERE]

```{r}
#run wilcox test 
compare_means(prop_diff_w ~ intervention, method = "wilcox.test", data = change_scores_1) %>%
  data.frame() %>%
  select(group1, group2, p.format) %>%
  kable(format = "pandoc")
  
qnorm(wilcox.test(change_scores_1$prop_diff_w ~ change_scores_1$intervention)$p.value/2)
  
change_scores_1 %>% wilcox_effsize(prop_diff_w ~ intervention) %>%
  select(-`.y.`) %>%
  kable(format = "pandoc")
```

### Study 2

[DESCRIBE RESULTS HERE]

```{r}
#run wilcox test 
compare_means(prop_diff_w ~ intervention, method = "wilcox.test", data = change_scores_2) %>%
  data.frame() %>%
  select(group1, group2, p.format) %>%
  kable(format = "pandoc")
  
qnorm(wilcox.test(change_scores_2$prop_diff_w ~ change_scores_2$intervention)$p.value/2)
  
change_scores_2 %>% wilcox_effsize(prop_diff_w ~ intervention) %>%
  select(-`.y.`) %>%
  kable(format = "pandoc")
```



